"use strict";(self.webpackChunk_patternslib_patternslib=self.webpackChunk_patternslib_patternslib||[]).push([[97557,84193],{22383:function(e,t,n){n.d(t,{y:function(){return l},z:function(){return d}});var r=n(86272),i=n(56938),a=n(57467),o=n(45814),s=n(73845);let c=null;async function l(e){let{url:t,editor:n,instance:l=null,pattern:u=null,extra_class:p=null}=e;const m=c,f=c=n.state.doc.nodeAt(n.state.selection.from);if(null===l||f===m&&l?.tippy.popperInstance||(await d({instance:l,pattern_name:u.name}),l=null),l&&l?.tippy.popperInstance)l.get_content(t);else{u&&(r.Z.patterns[u.name]=u);const e=n.options.element;l=await new o.ZP(e,{source:"ajax",url:t,trigger:"none",class:p,"position-list":["tl"]}),await a.Z.await_pattern_init(l);const c=(0,s.posToDOMRect)(n.view,n.state.selection.from,n.state.selection.to);l.tippy?.setProps({getReferenceClientRect:()=>c}),a.Z.add_event_listener(document,"mousedown","tiptap--context_menu_close--click",(async e=>{[e.target,...i.Z.get_parents(e.target)].includes(l?.tippy.popper)||(await d({instance:l,pattern_name:u.name}),l=null)})),a.Z.add_event_listener(document,"keydown","tiptap--context_menu_close--esc",(async e=>{"Escape"===e.key&&(await d({instance:l,pattern_name:u.name}),l=null)})),l.show()}return l}async function d(e){let{instance:t,pattern_name:n}=e;return t&&(await t.hide(),t.destroy(),t=null),n&&delete r.Z.patterns[n],a.Z.remove_event_listener(document,"tiptap--context_menu_close--click"),a.Z.remove_event_listener(document,"tiptap--context_menu_close--esc"),null}},97557:function(e,t,n){n.r(t),n.d(t,{factory:function(){return _},init:function(){return b}});var r=n(22383),i=n(84193),a=n(30450),o=n(73845),s=n(2376),c=n(92041),l=n(56938),d=n(57467),u=n(92452);function p(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}let m;function f(e){let{app:t}=e;class n extends c.o{init(){(0,i.focus_handler)(this.el);const e=this.el.querySelector(".tiptap-edit-embed"),n=this.el.querySelector(".tiptap-remove-embed");e&&e.addEventListener("click",(()=>{t.toolbar.embed.click()})),n&&n.addEventListener("click",(()=>{t.editor.commands.selectParentNode(),t.editor.commands.deleteSelection(),t.editor.commands.focus()}))}}return p(n,"name","tiptap-embed-context-menu"),p(n,"trigger",".tiptap-embed-context-menu"),n}function b(e){let{app:t,button:n}=e;n.addEventListener("click",(()=>{if(l.Z.get_data(t.toolbar_el,"tiptap-instance",null)!==t)return;const e=function(e){let{app:t}=e;return{name:"tiptap-embed-panel",trigger:t.options.embed?.panel,init(e){const n=e.querySelector("[name=tiptap-src]");if(!n)return void a.cM.warn("No src input in embed panel found.");const r=e.querySelector("[name=tiptap-title]"),o=e.querySelector("[name=tiptap-caption]"),s=e.querySelector(".tiptap-confirm, [name=tiptap-confirm]");(0,i.focus_handler)(e);const c=t.editor.state.doc.nodeAt(t.editor.state.selection.from);t.editor.commands.selectParentNode();const u=t.editor.state.doc.nodeAt(t.editor.state.selection.from)?.content.content.filter((e=>"figcaption"===e.type.name))?.[0];c&&(n.value=c.attrs?.src||"",r&&(r.value=c.attrs?.title||"")),u&&o&&(o.value=u.textContent||"");const p=e=>{t.editor.commands.insertContent({type:"figure",content:[{type:"embed",attrs:{src:n.value,...r?.value&&{title:r.value}}},...o?.value?[{type:"figcaption",content:[{type:"text",text:o.value}]}]:[]]}),!0===e&&(t.editor.commands.selectParentNode(),t.editor.commands.focus(t.editor.state.selection.to))},m=l.Z.querySelectorAllAndMe(e,"form")?.[0];m&&d.Z.add_event_listener(m,"submit","tiptap_embed_submit",(e=>{e.preventDefault()})),s?d.Z.add_event_listener(s,"click","tiptap_embed_confirm",(()=>p(!0))):(d.Z.add_event_listener(n,"change","tiptap_embed_src",p),d.Z.add_event_listener(r,"change","tiptap_embed_title",p),d.Z.add_event_listener(o,"change","tiptap_embed_caption",p))}}}({app:t});document.addEventListener("patterns-injected-delayed",(n=>{e.init(n.detail.injected),t.current_modal.addEventListener("patterns-injected-delayed",(()=>{e.init(t.current_modal)}))}),{once:!0})})),t.editor.on("selectionUpdate",(async()=>{t.editor.isActive("embed")?n.classList.add("active"):n.classList.remove("active"),t.editor.can().setEmbed()?n.classList.remove("disabled"):n.classList.add("disabled"),t.options.embed.menu&&u.Z.debounce((async()=>{t.editor.isActive("embed")?m=await(0,r.y)({url:t.options.embed.menu,editor:t.editor,instance:m,pattern:f({app:t}),extra_class:"tiptap-embed-menu"}):m&&(await(0,r.z)({instance:m,pattern_name:"tiptap-embed-context-menu"}),m=null)}),50)()}))}const _=()=>{const e=e=>e.indexOf("youtube.com")>-1,t=e=>e.indexOf("vimeo.com")>-1;return o.Node.create({name:"embed",addOptions(){return{HTMLAttributes:{}}},group:"block",allowGapCursor:!1,draggable:!1,isolating:!0,selectable:!0,addAttributes(){return{src:{default:null},title:{default:null}}},parseHTML(){return[{tag:'iframe[src*="youtube.com"]',getAttrs:n=>(e(n.getAttribute("src"))||t(n.getAttribute("src"))>-1)&&null}]},renderHTML(n){let{HTMLAttributes:r}=n;const i={width:"560",height:"315",allowfullscreen:"",frameborder:"0"},a={width:"640",height:"360",allowfullscreen:"",frameborder:"0"};let s;if(e(r.src)){s={...r,...i};const e=s.src.match(/watch.*v\=(?<vid>[^&]*)/)?.groups?.vid;e&&(s.src=`https://www.youtube.com/embed/${e}`)}if(t(r.src)){s={...r,...a};const e=s.src.match(/vimeo.com\/(?<vid>[0-9]*)/)?.groups?.vid;e&&(s.src=`https://player.vimeo.com/video/${e}`)}return["iframe",(0,o.mergeAttributes)(this.options.HTMLAttributes,s)]},addCommands(){return{setEmbed:e=>t=>{let{commands:n}=t;return n.insertContent({type:this.name,attrs:e})}}},addProseMirrorPlugins(){return[new s.Sy({props:{handleDOMEvents:{dragstart:(e,t)=>{if(!t.target)return!1;const n=e.posAtDOM(t.target,0);return e.state.doc.resolve(n).parent.type===this.type&&t.preventDefault(),!1}}}})]}})}},84193:function(e,t,n){n.r(t),n.d(t,{TARGETS:function(){return a},focus_handler:function(){return o}});var r=n(57467),i=n(92452);const a=[];function o(e){e.setAttribute("tabindex","-1"),r.Z.add_event_listener(e,"focus","tiptap-focusin",(async()=>{i.Z.timeout(1),a.map((e=>e?.classList.add("tiptap-focus")))}),!0),r.Z.add_event_listener(e,"blur","tiptap-focusout",(()=>{a.map((e=>e?.classList.remove("tiptap-focus")))}),!0)}}}]);
//# sourceMappingURL=97557.0fb0c913e66105ed6ece.min.js.map