"use strict";(self.webpackChunk_patternslib_patternslib=self.webpackChunk_patternslib_patternslib||[]).push([[79829],{79829:function(t,e,s){s.r(e),s.d(e,{Dropcursor:function(){return d},default:function(){return d}});var i=s(73845),o=s(2376),r=s(16560);function l(t={}){return new o.Sy({view(e){return new n(e,t)}})}class n{constructor(t,e){this.editorView=t,this.cursorPos=null,this.element=null,this.timeout=-1,this.width=e.width||1,this.color=e.color||"black",this.class=e.class,this.handlers=["dragover","dragend","drop","dragleave"].map((e=>{let s=t=>{this[e](t)};return t.dom.addEventListener(e,s),{name:e,handler:s}}))}destroy(){this.handlers.forEach((({name:t,handler:e})=>this.editorView.dom.removeEventListener(t,e)))}update(t,e){null!=this.cursorPos&&e.doc!=t.state.doc&&(this.cursorPos>t.state.doc.content.size?this.setCursor(null):this.updateOverlay())}setCursor(t){t!=this.cursorPos&&(this.cursorPos=t,null==t?(this.element.parentNode.removeChild(this.element),this.element=null):this.updateOverlay())}updateOverlay(){let t,e=this.editorView.state.doc.resolve(this.cursorPos),s=!e.parent.inlineContent;if(s){let s=e.nodeBefore,i=e.nodeAfter;if(s||i){let e=this.editorView.nodeDOM(this.cursorPos-(s?s.nodeSize:0));if(e){let o=e.getBoundingClientRect(),r=s?o.bottom:o.top;s&&i&&(r=(r+this.editorView.nodeDOM(this.cursorPos).getBoundingClientRect().top)/2),t={left:o.left,right:o.right,top:r-this.width/2,bottom:r+this.width/2}}}}if(!t){let e=this.editorView.coordsAtPos(this.cursorPos);t={left:e.left-this.width/2,right:e.left+this.width/2,top:e.top,bottom:e.bottom}}let i,o,r=this.editorView.dom.offsetParent;if(this.element||(this.element=r.appendChild(document.createElement("div")),this.class&&(this.element.className=this.class),this.element.style.cssText="position: absolute; z-index: 50; pointer-events: none; background-color: "+this.color),this.element.classList.toggle("prosemirror-dropcursor-block",s),this.element.classList.toggle("prosemirror-dropcursor-inline",!s),!r||r==document.body&&"static"==getComputedStyle(r).position)i=-pageXOffset,o=-pageYOffset;else{let t=r.getBoundingClientRect();i=t.left-r.scrollLeft,o=t.top-r.scrollTop}this.element.style.left=t.left-i+"px",this.element.style.top=t.top-o+"px",this.element.style.width=t.right-t.left+"px",this.element.style.height=t.bottom-t.top+"px"}scheduleRemoval(t){clearTimeout(this.timeout),this.timeout=setTimeout((()=>this.setCursor(null)),t)}dragover(t){if(!this.editorView.editable)return;let e=this.editorView.posAtCoords({left:t.clientX,top:t.clientY}),s=e&&e.inside>=0&&this.editorView.state.doc.nodeAt(e.inside),i=s&&s.type.spec.disableDropCursor,o="function"==typeof i?i(this.editorView,e,t):i;if(e&&!o){let t=e.pos;if(this.editorView.dragging&&this.editorView.dragging.slice&&(t=(0,r.nj)(this.editorView.state.doc,t,this.editorView.dragging.slice),null==t))return this.setCursor(null);this.setCursor(t),this.scheduleRemoval(5e3)}}dragend(){this.scheduleRemoval(20)}drop(){this.scheduleRemoval(20)}dragleave(t){t.target!=this.editorView.dom&&this.editorView.dom.contains(t.relatedTarget)||this.setCursor(null)}}const d=i.Extension.create({name:"dropCursor",addOptions(){return{color:"currentColor",width:1,class:void 0}},addProseMirrorPlugins(){return[l(this.options)]}})}}]);
//# sourceMappingURL=79829.ddfa47f9e4a5dd37bfc3.min.js.map